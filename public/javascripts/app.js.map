{"version":3,"file":"public/javascripts/app.js","sources":["app/javascripts/app.js","app/javascripts/controllers/companies_controller.js","app/javascripts/factories/companies.js","app/javascripts/router.js"],"names":[],"mappings":"AAAA;AACA;A,CCDA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;A,CC5BA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;A,CC5DA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;A","sourcesContent":["var app = angular.module('tekusage', ['ngRoute']);\n","CompaniesListController = function($scope, Company, queryString) {\n  $scope.companies = Company.search(queryString, function(companies) {\n    $scope.$apply(function() {\n      $scope.companies = companies;\n    });\n  });\n\n  $scope.companiesPartialName = function() {\n    template_name = ($scope.companies && $scope.companies.length > 0) ? 'companies' : 'empty'\n    return 'partials/companies/' + template_name + '.html';\n  };\n\n  $scope.addCompanyFromGithub = function() {\n    url  = 'https://github.com/kdisneur/website/issues/new?';\n    url += 'title=Add%20a%20company';\n    url += '&body=';\n    url += '*%20Name:%0A';\n    url += '*%20Website:%0A';\n    url += '*%20Technologies:%0A';\n    url += '*%20Number%20of%20employees:%0A';\n    url += '*%20Type:%0A';\n    url += '*%20Addresses:%0A';\n\n    window.location.href = url;\n  };\n};\n\nCompaniesListController.$inject = ['$scope', 'Company', 'queryString'];\n","CompanyFinder = function() {\n  var computeLocationTerms = function(memo, value, field) {\n    object = { match: {} };\n    object['locations.' + field] = value;\n    memo.push(object);\n    return memo;\n  };\n\n  var computeTerms = function(memo, value, field) {\n    object = { term: {} };\n    object['term'][field] = value;\n    memo.push(object);\n    return memo;\n  };\n\n  var locationQuery = function(queryString) {\n    if (!!queryString) return {};\n\n    return {\n      filter: {\n        nested: {\n          path: 'locations',\n          query: {\n            bool: {\n              must: _.reduce(queryString, computeLocationTerms, [])\n            }\n          }\n        }\n      }\n    };\n  };\n\n  var normalQuery = function(queryString) {\n    return {\n      filtered: { query: _.reduce(queryString, computeTerms, []) }\n    };\n  };\n\n  var query = function(queryString) {\n    if (queryString == null) return { match_all: {} };\n    return _.extend({}, normalQuery(queryString), locationQuery(queryString['locations']));\n  };\n\n  return {\n    host:    '192.168.1.51:9200',\n    indices: 'tekusage',\n    types:   'company',\n    search: function(queryString, callback) {\n      new elasticsearch.Client({ host: this.host, log: 'trace'}).search({\n        index: this.indices,\n        type:  this.types,\n        body:  { query: query(queryString) }\n      }, function(error, results, status) {\n        callback(_.map(results.hits.hits, function(hit) { return hit._source }));\n      });\n    }\n  };\n}\n\napp.factory('Company', CompanyFinder);\n","app.config(['$routeProvider', '$locationProvider', function($routeProvider, $locationProvider) {\n  $routeProvider.when('/companies-using-:technology-in-:city,:country', {\n    templateUrl: 'partials/companies/list.html',\n    controller:  CompaniesListController,\n    resolve:     {\n      queryString: function($route) {\n        return {\n          'technologies':      $route.current.params.technology,\n          'company.locations.country': $route.current.params.country,\n          'company.locations.city':    $route.current.params.city\n        }\n      }\n    }\n  });\n\n  $routeProvider.when('/companies-using-:technology', {\n    templateUrl: 'partials/companies/list.html',\n    controller:  CompaniesListController,\n    resolve:     {\n      queryString: function($route) {\n        return { 'technologies': $route.current.params.technology };\n      }\n    }\n  });\n\n  $routeProvider.when('/companies', {\n    templateUrl: 'partials/companies/list.html',\n    controller:  CompaniesListController,\n    resolve: {\n      queryString: function() { return null; },\n    }\n  });\n\n  $routeProvider.otherwise({ redirectTo: '/companies' });\n}]);\n"]}